<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Craft Admin Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    
    <style>
        /* Brand Colors */
        :root {
            --primary-orange: #FF6B00;
            --primary-green: #4CAF50;
            --dark-blue: #0d1b2a;
        }
        
        .brand-orange {
            color: var(--primary-orange);
        }
        
        .brand-green {
            color: var(--primary-green);
        }
        
        .navbar {
            background-color: #000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-link {
            color: #fff;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .nav-link:hover {
            color: var(--primary-orange);
        }
        
        .nav-link.active {
            color: var(--primary-orange);
        }
        
        .profile-img {
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .profile-img:hover {
            transform: scale(1.25);
        }
        
        .card {
            transition: all 0.3s ease;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .btn-custom {
            background-color: var(--primary-green);
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-custom:hover {
            background-color: #388E3C;
            transform: translateY(-2px);
        }
        
        .admin-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .footer {
            background-color: #000;
            color: white;
            padding: 2rem 0;
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(0,0,0,0.075);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <!-- Brand -->
            <a href="index.html" class="navbar-brand d-flex align-items-center">
                
                <span class="brand-orange">CAREER</span>
                <span class="brand-green ms-2">CRAFT</span>
            </a>

            <!-- Mobile Toggle -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navigation Links -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto gap-4">
                    <li class="nav-item">
                        <a href="#course-management" class="nav-link">Course Management</a>
                    </li>
                    <li class="nav-item">
                        <a href="#user-management" class="nav-link">User Management</a>
                    </li>
                    <li class="nav-item">
                        <a href="#analytics" class="nav-link">Analytics & Reporting</a>
                    </li>
                    <li class="nav-item">
                        <a href="admin-login.html" class="nav-link">Logout</a>
                    </li>
                </ul>
                <!-- Profile Picture -->
                <div class="ms-3">
                    <a href="admin-profile.html">
                        <img src="https://github.com/PlusPioneers/CareerCraftProject/blob/main/Images/Profile%20image.png?raw=true" alt="Profile" class="rounded-circle profile-img">
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid px-4">
        <!-- Course Management Section -->
        <section id="course-management" class="admin-section">
            <h2 class="mb-4">Course Management</h2>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <button class="btn btn-custom" data-bs-toggle="modal" data-bs-target="#addCourseModal">
                        <i class="fas fa-plus me-2"></i>Add New Course
                    </button>
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control" placeholder="Search Courses" id="courseSearch">
                </div>
            </div>

            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Course ID</th>
                        <th>Course Name</th>
                        <th>Category</th>
                        <th>Level</th>
                        <th>Duration</th>
                    </tr>
                </thead>
                <tbody id="coursesTableBody">
                    <tr>
                        
                        <td>
                            <button class="btn btn-sm btn-primary me-2" data-bs-toggle="modal" data-bs-target="#editCourseModal">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    <!-- More course rows will be dynamically added -->
                </tbody>
            </table>
        </section>

        <!-- User Management Section -->
        <section id="user-management" class="admin-section">
            <h2 class="mb-4">User Management</h2>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <button class="btn btn-custom" data-bs-toggle="modal" data-bs-target="#addUserModal">
                        <i class="fas fa-user-plus me-2"></i>Add New User
                    </button>
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control" placeholder="Search Users" id="userSearch">
                </div>
            </div>

            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>User ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <!-- Dynamic user rows will be added here -->
                </tbody>
            </table>
        </section>

        <!-- Analytics and Reporting Section -->
        <section id="analytics" class="admin-section">
         <div class="col-md-4 mb-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Total Users</h5>
                    <p class="card-text display-4" id="totalUsersCount">0</p>
                </div>
            </div>
        </div>

    <!-- Modals for Adding/Editing Courses and Users -->
    <!-- Add Course Modal -->
    <div class="modal fade" id="addCourseModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Course</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addCourseForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Course Name</label>
                                <input type="text" class="form-control" id="newCourseName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Instructor Name</label>
                                <input type="text" class="form-control" id="newCourseInstructor" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Course Description</label>
                            <textarea class="form-control" id="newCourseDescription" rows="3" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Field/Department</label>
                                <select class="form-select" id="newCourseField" required>
                                    <option value="">Select Field</option>
                                    <option>Computer Science</option>
                                    <option>Biology</option>
                                    <option>Commerce</option>
                                    <option>Engineering</option>
                                    <option>Arts</option>
                                    <option>Social Sciences</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Course Level</label>
                                <select class="form-select" id="newCourseLevel" required>
                                    <option value="">Select Level</option>
                                    <option>Beginner</option>
                                    <option>Intermediate</option>
                                    <option>Advanced</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Duration</label>
                                <input type="text" class="form-control" id="newCourseDuration" placeholder="e.g., 4 Weeks" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-custom">Add Course</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Similar updates needed for Edit Course Modal -->
    <div class="modal fade" id="editCourseModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Course</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editCourseForm">
                        <input type="hidden" id="editCourseId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Course Name</label>
                                <input type="text" class="form-control" id="editCourseName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Instructor Name</label>
                                <input type="text" class="form-control" id="editCourseInstructor" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Course Description</label>
                            <textarea class="form-control" id="editCourseDescription" rows="3" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Field/Department</label>
                                <select class="form-select" id="editCourseField" required>
                                    <option value="">Select Field</option>
                                    <option>Computer Science</option>
                                    <option>Biology</option>
                                    <option>Commerce</option>
                                    <option>Engineering</option>
                                    <option>Arts</option>
                                    <option>Social Sciences</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Course Level</label>
                                <select class="form-select" id="editCourseLevel" required>
                                    <option value="">Select Level</option>
                                    <option>Beginner</option>
                                    <option>Intermediate</option>
                                    <option>Advanced</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Duration</label>
                                <input type="text" class="form-control" id="editCourseDuration" placeholder="e.g., 4 Weeks" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-custom">Update Course</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Add User Modal -->
    <!-- Update the Add User Modal -->
     <div class="modal fade" id="addUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addUserForm">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Role</label>
                            <select class="form-select" required>
                                <option value="">Select Role</option>
                                <option value="Student">Student</option>
                                <option value="Instructor">Instructor</option>
                                <option value="Admin">Admin</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-custom">Add User</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Add Edit User Modal -->
     <div class="modal fade" id="editUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editUserForm">
                        <input type="hidden" id="editUserId">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="editUserName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="editUserEmail" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Role</label>
                            <select class="form-select" id="editUserRole" required>
                                <option value="Student">Student</option>
                                <option value="Instructor">Instructor</option>
                                <option value="Admin">Admin</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-custom">Update User</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer (Same as student dashboard) -->
    <footer class="footer mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <img src="https://github.com/PlusPioneers/CareerCraftProject/blob/main/Images/MOE%20Logo.png?raw=true" alt="Government Logo" class="mb-3" style="cursor: pointer;">
                    <h5>
                        <span class="brand-orange">CAREER</span> 
                        <span class="brand-green">CRAFT</span>
                    </h5>
                    <p class="text-white">Crafting Skills, Shaping Futures</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <h5>Contact Information:</h5>
                    <p><a href="#" class="text-white text-decoration-none">Email: support@careercraft.com</a></p>
                    <p><a href="#" class="text-white text-decoration-none">Phone: +91 9940587477</a></p>
                    <p><a href="#" class="text-white text-decoration-none">Address: 123 Career Street, Education City, India.</a></p>
                </div>
            </div>
            <div class="text-center mt-4">
                <p class="text-white">Â© 2024 Career Craft. All Rights Reserved</p>
            </div>
        </div>
    </footer>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, set, get, update, remove, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Firebase Configuration (remains the same)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY_HERE",
            authDomain: "your-project-id.firebaseapp.com",
            databaseURL: "https://your-project-id.firebaseio.com",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID",
            measurementId: "YOUR_MEASUREMENT_ID"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);

        // Updated Course Management Functions
        function renderCourses(courses) {
            const tableBody = document.getElementById('coursesTableBody');
            tableBody.innerHTML = ''; // Clear existing rows

            Object.entries(courses).forEach(([courseId, courseData]) => {
                const row = `
                    <tr>
                        <td>${courseId}</td>
                        <td>${courseData.name}</td>
                        <td>${courseData.category}</td>
                        <td>${courseData.level}</td>
                        <td>${courseData.duration}</td>
                        <td>
                            <button class="btn btn-sm btn-primary edit-course" 
                                data-id="${courseId}"
                                data-name="${courseData.name}"
                                data-instructor="${courseData.instructor}"
                                data-description="${courseData.description}"
                                data-category="${courseData.category}"
                                data-level="${courseData.level}"
                                data-duration="${courseData.duration}"
                                data-bs-toggle="modal" 
                                data-bs-target="#editCourseModal">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger delete-course" data-id="${courseId}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });

            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-course').forEach(button => {
                button.addEventListener('click', (e) => {
                    const courseId = e.currentTarget.getAttribute('data-id');
                    const courseName = e.currentTarget.getAttribute('data-name');
                    const courseInstructor = e.currentTarget.getAttribute('data-instructor');
                    const courseDescription = e.currentTarget.getAttribute('data-description');
                    const courseCategory = e.currentTarget.getAttribute('data-category');
                    const courseLevel = e.currentTarget.getAttribute('data-level');
                    const courseDuration = e.currentTarget.getAttribute('data-duration');

                    document.getElementById('editCourseId').value = courseId;
                    document.getElementById('editCourseName').value = courseName;
                    document.getElementById('editCourseInstructor').value = courseInstructor;
                    document.getElementById('editCourseDescription').value = courseDescription;
                    document.getElementById('editCourseField').value = courseField;
                    document.getElementById('editCourseLevel').value = courseLevel;
                    document.getElementById('editCourseDuration').value = courseDuration;
                });
            });

            document.querySelectorAll('.delete-course').forEach(button => {
                button.addEventListener('click', (e) => {
                    const courseId = e.currentTarget.getAttribute('data-id');
                    deleteCourse(courseId);
                });
            });
        }

        // Fetch Courses (remains the same)
        function fetchCourses() {
            const coursesRef = ref(database, 'courses');
            onValue(coursesRef, (snapshot) => {
                const courses = snapshot.val();
                renderCourses(courses || {});
            });
        }

        // Updated Add Course
        document.getElementById('addCourseForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const coursesRef = ref(database, 'courses');
            const newCourseRef = push(coursesRef);
            
            set(newCourseRef, {
                name: document.getElementById('newCourseName').value,
                instructor: document.getElementById('newCourseInstructor').value,
                description: document.getElementById('newCourseDescription').value,
                field: document.getElementById('newCourseField').value,
                level: document.getElementById('newCourseLevel').value,
                duration: document.getElementById('newCourseDuration').value
            }).then(() => {
                // Close modal and reset form
                bootstrap.Modal.getInstance(document.getElementById('addCourseModal')).hide();
                e.target.reset();
            }).catch((error) => {
                console.error("Error adding course: ", error);
            });
        });

        // Updated Update Course
        document.getElementById('editCourseForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const courseId = document.getElementById('editCourseId').value;
            const courseRef = ref(database, `courses/${courseId}`);
            
            update(courseRef, {
                name: document.getElementById('editCourseName').value,
                instructor: document.getElementById('editCourseInstructor').value,
                description: document.getElementById('editCourseDescription').value,
                field: document.getElementById('editCourseField').value,
                level: document.getElementById('editCourseLevel').value,
                duration: document.getElementById('editCourseDuration').value
            }).then(() => {
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('editCourseModal')).hide();
            }).catch((error) => {
                console.error("Error updating course: ", error);
            });
        });

        // Delete Course (remains the same)
        function deleteCourse(courseId) {
            if (confirm('Are you sure you want to delete this course?')) {
                const courseRef = ref(database, `courses/${courseId}`);
                remove(courseRef).catch((error) => {
                    console.error("Error deleting course: ", error);
                });
            }
        }

        // Authentication Check (remains the same)
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                // Redirect to login if not authenticated
                window.location.href = 'login.html';
            } else {
                // Fetch courses when authenticated
                fetchCourses();
            }
        });

        

        function renderUsers(students, instructors) {
    const tableBody = document.getElementById('usersTableBody');
    tableBody.innerHTML = ''; // Clear existing rows

    // Render Students
    if (students) {
        Object.entries(students).forEach(([studentId, studentData]) => {
            const row = `
            <tr>
                <td>${studentId}</td>
                <td>${studentData.name}</td>
                <td>${studentData.email}</td>
                <td>Student</td>
                <td>
                    <button class="btn btn-sm btn-primary edit-user" 
                    data-id="${studentId}"
                    data-name="${studentData.name}"
                    data-email="${studentData.email}"
                    data-role="Student"
                    data-bs-toggle="modal" 
                    data-bs-target="#editUserModal">
                    <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger delete-user" data-id="${studentId}" data-type="student">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
            `;
            tableBody.innerHTML += row;
        });
    }

    // Render Instructors
    if (instructors) {
        Object.entries(instructors).forEach(([instructorId, instructorData]) => {
            const row = `
            <tr>
                <td>${instructorId}</td>
                <td>${instructorData.basicInfo.fullName}</td>
                <td>${instructorData.email}</td>
                <td>Instructor</td>
                <td>
                    <button class="btn btn-sm btn-primary edit-user" 
                    data-id="${instructorId}"
                    data-name="${instructorData.basicInfo.fullName}"
                    data-email="${instructorData.email}"
                    data-role="Instructor"
                    data-bs-toggle="modal" 
                    data-bs-target="#editUserModal">
                    <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger delete-user" data-id="${instructorId}" data-type="instructor">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
            `;
            tableBody.innerHTML += row;
        });
    }

    // Add event listeners for edit and delete buttons
    document.querySelectorAll('.edit-user').forEach(button => {
        button.addEventListener('click', (e) => {
            const uId = e.currentTarget.getAttribute('data-id');
            const fullName = e.currentTarget.getAttribute('data-name');
            const email = e.currentTarget.getAttribute('data-email');
            const role = e.currentTarget.getAttribute('data-role');

            document.getElementById('editUserId').value = uId;
            document.getElementById('editUserName').value = fullName;
            document.getElementById('editUserEmail').value = email;

            // Set role and enable role selection
            document.getElementById('editUserRole').value = role;
            document.getElementById('editUserRole').disabled = false;
        });
    });

    document.querySelectorAll('.delete-user').forEach(button => {
        button.addEventListener('click', (e) => {
            const uId = e.currentTarget.getAttribute('data-id');
            const userType = e.currentTarget.getAttribute('data-type');
            deleteUser(uId, userType);
        });
    });
}

// Updated Fetch Users function
function fetchUsers() {
    const studentsRef = ref(database, 'students');
    const instructorsRef = ref(database, 'Instructor');

    // Fetch both students and instructors
    Promise.all([
        get(studentsRef),
        get(instructorsRef)
    ]).then(([studentsSnapshot, instructorsSnapshot]) => {
        const students = studentsSnapshot.val();
        const instructors = instructorsSnapshot.val();

        // Render users
        renderUsers(students, instructors);

        // Update total users count
        const totalUsersCount = 
            (students ? Object.keys(students).length : 0) + 
            (instructors ? Object.keys(instructors).length : 0);
        
        const totalUsersElement = document.getElementById('totalUsersCount');
        if (totalUsersElement) {
            totalUsersElement.textContent = totalUsersCount;
        }
    }).catch((error) => {
        console.error("Error fetching users: ", error);
    });
}

// Updated Add User form submission
document.getElementById('addUserForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const name = document.querySelector('#addUserModal input[type="text"]').value;
    const email = document.querySelector('#addUserModal input[type="email"]').value;
    const role = document.querySelector('#addUserModal select').value;

    if (role === 'Student') {
        const studentsRef = ref(database, 'students');
        const newStudentRef = push(studentsRef);    
        set(newStudentRef, {
            name: name,
            email: email
        }).then(() => {
            bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();
            e.target.reset();
        }).catch((error) => {
            console.error("Error adding student: ", error);
        });
    } else if (role === 'Instructor') {
        const instructorsRef = ref(database, 'Instructor');
        const newInstructorRef = push(instructorsRef);    
        set(newInstructorRef, {
            name: name,
            email: email
        }).then(() => {
            bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();
            e.target.reset();
        }).catch((error) => {
            console.error("Error adding instructor: ", error);
        });
    }
});

// Updated Edit User form submission
document.getElementById('editUserForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const userId = document.getElementById('editUserId').value;
    const name = document.getElementById('editUserName').value;
    const email = document.getElementById('editUserEmail').value;
    const role = document.getElementById('editUserRole').value;

    if (role === 'Student') {
        const studentRef = ref(database, `students/${userId}`);
        update(studentRef, {
            name: name,
            email: email
        }).then(() => {
            bootstrap.Modal.getInstance(document.getElementById('editUserModal')).hide();
        }).catch((error) => {
            console.error("Error updating student: ", error);
        });
    } else if (role === 'Instructor') {
        const instructorRef = ref(database, `Instructor/${userId}`);
        update(instructorRef, {
            name: name,
            email: email
        }).then(() => {
            bootstrap.Modal.getInstance(document.getElementById('editUserModal')).hide();
        }).catch((error) => {
            console.error("Error updating instructor: ", error);
        });
    }
});

// Updated Delete User function
function deleteUser(userId, userType) {
    if (confirm('Are you sure you want to delete this user?')) {
        let userRef;
        if (userType === 'student') {
            userRef = ref(database, `students/${userId}`);
        } else if (userType === 'instructor') {
            userRef = ref(database, `Instructor/${userId}`);
        }

        remove(userRef).catch((error) => {
            console.error(`Error deleting ${userType}: `, error);
        });
    }
}

// Authentication state change listener
onAuthStateChanged(auth, (user) => {
    if (!user) {
        // Redirect to login if not authenticated
        window.location.href = 'admin-login.html';
    } else {
        // Fetch users when authenticated
        fetchUsers();
    }
});

// Search functionality
document.getElementById('userSearch').addEventListener('input', (e) => {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('#usersTableBody tr');
    rows.forEach(row => {
        const cells = row.getElementsByTagName('td');
        const isVisible = Array.from(cells).some(cell => 
            cell.textContent.toLowerCase().includes(searchTerm)
        );
        row.style.display = isVisible ? '' : 'none';
    });
});
// Search functionality
document.getElementById('courseSearch').addEventListener('input', (e) => {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('#coursesTableBody tr');
    rows.forEach(row => {
        const cells = row.getElementsByTagName('td');
        const isVisible = Array.from(cells).some(cell => 
            cell.textContent.toLowerCase().includes(searchTerm)
        );
        row.style.display = isVisible ? '' : 'none';
    });
});
    </script>

    <!-- Bootstrap and JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
</body>
</html>

